"0","library(brms)"
"0","library(ggplot2)"
"0","library(posterior)  # for as_draws_df()"
"2","This is posterior version 1.6.1
"
"2","
Attaching package: ‘posterior’

"
"2","The following objects are masked from ‘package:stats’:

    mad, sd, var

"
"2","The following objects are masked from ‘package:base’:

    %in%, match

"
"0","# 成人先验信息"
"0","log_or_adult <- log((375 * (494 - 45)) / (45 * (509 - 375)))"
"0","se_log_or_adult <- sqrt(1/375 + 1/(509 - 375) + 1/45 + 1/(494 - 45))"
"0","var_adult <- se_log_or_adult^2"
"0",""
"0","# 儿童数据"
"0","ped_data <- data.frame("
"0","  group = c(""drug"", ""placebo""),"
"0","  success = c(15, 1),"
"0","  total = c(30, 6)"
"0",")"
"0","ped_data$group <- factor(ped_data$group, levels = c(""placebo"", ""drug""))"
"0",""
"0","# 权重向量"
"0","weights <- seq(0, 1, 0.02)"
"0",""
"0","# 初始化结果"
"0","or_medians <- numeric(length(weights))"
"0","or_lowers <- numeric(length(weights))"
"0","or_uppers <- numeric(length(weights))"
"0",""
"0","# 循环拟合"
"0","for (i in seq_along(weights)) {"
"0","  if (weights[i] == 0) {"
"0","    # vague prior"
"0","    fit_i <- brm("
"0","      formula = success | trials(total) ~ group,"
"0","      data = ped_data,"
"0","      family = binomial(),"
"0","      prior = set_prior(""normal(0, 10000)"", class = ""b"", coef = ""groupdrug""),"
"0","      iter = 2000, chains = 2, refresh = 0, silent = 2"
"0","    )"
"0","  } else {"
"0","    new_var <- var_adult / weights[i]"
"0","    prior_string <- paste0(""normal("", round(log_or_adult, 3), "", "", round(new_var, 4), "")"")"
"0","    "
"0","    fit_i <- brm("
"0","      formula = success | trials(total) ~ group,"
"0","      data = ped_data,"
"0","      family = binomial(),"
"0","      prior = set_prior(prior_string, class = ""b"", coef = ""groupdrug""),"
"0","      iter = 2000, chains = 2, refresh = 0, silent = 2"
"0","    )"
"0","  }"
"0",""
"0","  # 提取 OR 分布"
"0","  posterior_OR <- exp(as_draws_df(fit_i)$b_groupdrug)"
"0","  or_medians[i] <- median(posterior_OR)"
"0","  or_lowers[i] <- quantile(posterior_OR, 0.025)"
"0","  or_uppers[i] <- quantile(posterior_OR, 0.975)"
"0","}"
"0",""
